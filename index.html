<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Panel Protegido</title>

    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
        #app { display: none; }
    </style>
</head>
<body>

    <!-- LOGIN -->
    <div id="login" style="text-align:center; margin-top:40px;">
        <h2>Iniciar sesión</h2>

        <!-- Botón de Google -->
        <div id="g_id_onload"
            data-client_id="449560223226-s67499o99vrurmdnp87ju5hsabhk743g.apps.googleusercontent.com"
            data-callback="handleCredentialResponse"
            data-auto_prompt="false">
        </div>

        <div class="g_id_signin"
            data-type="standard"
            data-shape="rectangular"
            data-theme="outline"
            data-text="signin_with"
            data-size="large">
        </div>
    </div>

    <!-- CONTENIDO REAL -->
    <div id="app">
        <h1>Bienvenido!</h1>
        <p>Ya estás dentro del sistema protegido.</p>

        <pre id="dataBox"></pre>
    </div>

    <script>
        async function handleCredentialResponse(response) {
            try {
                const token = response.credential;

                const res = await fetch(
                    "https://script.google.com/macros/s/AKfycbx6j4DwX9zpE7zzPhifTMbpuDWcmUtM35agL48qhhb8ABY29y1IWc2ayAxMBMfyTPXH/exec",
                    {
                        method: "GET",
                        headers: {
                            "Authorization": "Bearer " + token
                        }
                    }
                );

                const data = await res.json();

                if (!data.success) {
                    alert("Usuario no autorizado");
                    return;
                }

                // Mostrar contenido
                document.getElementById("login").style.display = "none";
                document.getElementById("app").style.display = "block";

                // Mostrar datos en pantalla
                document.getElementById("dataBox").textContent =
                    JSON.stringify(data.data, null, 2);

            } catch (e) {
                alert("Error conectando con el servidor");
                console.error(e);
            }
        }
    </script>

</body>
</html>
